<section class="container-fluid bg-ice-white show-animation">
    <div class="container py-5">
        <p class="text-primary fw-semibold letter-spacing-2 mb-1">EDITAR ANÚNCIO</p>
        <h1 class="custom-dark fw-bolder mb-2 mb-md-5 ">{{ formListing.value.title }}</h1>
        <hr class="custom-hr-dark">

        <ul ngbNav #nav="ngbNav" [(activeId)]="navbarActive" class="nav-tabs">
            <li [ngbNavItem]="1">
                <button ngbNavLink class="fw-semibold opacity-75">Informações</button>
                <ng-template ngbNavContent>
                    <form [formGroup]="formListing" class="py-4">
                        <div class="row my-3">
                            <h4 class="text-primary fw-semibold opacity-75 mb-3">Básico</h4>
                            <div class="col-12 col-md-6">
                                <div class="mb-4 mb-md-5">
                                    <label for="title" class="mb-2 custom-subtitle-dark letter-spacing-1">TÍTULO DO ANÚNCIO<span class="text-danger">*</span></label>
                                    <input type="text" name="title" id="title" formControlName="title"
                                    class="form-control custom_focus custom_placeholder bg-transparent text-secondary" 
                                    [ngClass]="{'invalid_input': formListing.get('title')?.invalid && formListing.get('title')?.touched}">
                                </div>
                            </div>
                            <div class="col-12 col-md-6">
                                <div class="mb-4">
                                    <label for="summary" class="mb-2 custom-subtitle-dark letter-spacing-1">DESCRIÇÃO SIMPLES<span class="text-danger">*</span></label>
                                    <input type="text" name="summary" id="summary" formControlName="summary" 
                                    class="form-control custom_focus custom_placeholder bg-transparent text-secondary" 
                                    [ngClass]="{'invalid_input': formListing.get('summary')?.invalid && formListing.get('summary')?.touched}">
                                </div>
                            </div>
            
                            @if(getFieldPlans(plansInfo.detailedDescription)) {
                                <div class="col-12">
                                    <div class="mb-4">
                                        <label for="description" class="mb-2 custom-subtitle-dark letter-spacing-1">DESCRIÇÃO</label>
                                        <textarea name="description" formControlName="description" id="description" cols="30" rows="7" 
                                        class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Fale um pouco sobre seu negocio"></textarea>
                                    </div>
                                </div>
                            }
                            <hr class="custom-hr-dark mb-4 mb-md-5">
            
                            <h4 class="text-primary fw-semibold opacity-75 mb-3">SEO</h4>
                            <div class="col-12 col-md-6 mb-4">
                                <label for="search" class="mb-2 custom-subtitle-dark letter-spacing-1">ESCOLHA SUAS CATEGORIAS</label>
            
                                @if (categoriesSelect.length) {
                                    <div class="d-flex flex-wrap gap-1 my-2 border rounded-1 p-2">
                                        <!-- Categorias Selected-->
                                        @for (category of categoriesSelect; track $index) {
                                            <span class="bg-primary text-white p-1 rounded-1 d-flex align-items-center">{{ category.cat_name}} <i class="fa-solid fa-xmark text-danger fs-5 ms-1 cursor_pointer" (click)="removeCategory(category.id)"></i></span>
                                        }
                                    </div>
                                }
            
                                <div class="dropdown mb-4">
                                    <button class="btn btn-light dropdown-toggle custom-subtitle-dark letter-spacing-1 border" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        CATEGORIAS
                                    </button>
                                    <ul class="dropdown-menu p-2 custom_scroll">
                                        <input [(ngModel)]="searchCategory" [ngModelOptions]="{ standalone: true }" type="text" name="search" id="search" (input)="filterCategories()" class="form-control-sm form-control custom_focus custom_placeholder rounded-1" placeholder="Buscar categoria">
            
                                        @for (category of searchItensCategory; track $index) {
                                            <li (click)="setCategory(category)" class="dropdown-item cursor_pointer">{{ category.cat_name }}</li>
                                        }
            
                                    </ul>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 mb-4">
                                <label for="keywords" class="mb-2 custom-subtitle-dark letter-spacing-1">PALAVRAS-CHAVES<i class="fa-regular fa-circle-question ms-1 cursor_pointer" [ngbTooltip]="tooltips.keywords"></i></label>
            
                                @if (keywords.length) {
                                    <div class="d-flex flex-wrap gap-1 my-2 border rounded-1 p-2">
                                        <!-- Keywords Selected -->
                                        @for (keyword of keywords; track $index) {
                                            <span class="bg-secondary text-white p-1 rounded-1 d-flex align-items-center">{{ keyword }} <i class="fa-solid fa-xmark text-danger fs-5 ms-1 cursor_pointer" (click)="removeKeyword(keyword)"></i></span>
                                        }
            
                                    </div>
                                }
            
                                <div class="d-flex gap-1">
                                    <input [(ngModel)]="searchKeywords" [ngModelOptions]="{ standalone: true }" type="text" id="keywords" class="form-control custom_focus custom_placeholder bg-transparent" placeholder="Digite suas palavras chaves">
                                    <button type="button" class="btn btn-primary" (click)="setKeywords(searchKeywords)">ADICIONAR</button>
                                </div>
                            </div>
                            <hr class="custom-hr-dark mb-4 mb-md-5">
            
                            <h4 class="text-primary fw-semibold opacity-75 mb-3">Localização</h4>
                            <div class="col-12 col-md-6">
                                <div class="mb-4">
                                    <label for="address" class="mb-2 custom-subtitle-dark letter-spacing-1">ENDEREÇO</label>
                                    <input type="text" name="address" formControlName="address" id="address" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" autocomplete="street-address" placeholder="Seu endereço">
                                </div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="mb-4">
                                    <label for="city" class="mb-2 custom-subtitle-dark letter-spacing-1">CIDADE</label>
                                    <input type="text" name="city" formControlName="city" id="city" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Sua cidade">
                                </div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="mb-4">
                                    <label for="state" class="mb-2 custom-subtitle-dark letter-spacing-1">ESTADO</label>
                                    <input type="text" name="state" formControlName="state" id="state" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Seu estado">
                                </div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="mb-4">
                                    <label for="zipCode" class="mb-2 custom-subtitle-dark letter-spacing-1">CEP</label>
                                    <input type="text" name="zipCode" formControlName="zipCode" id="zipCode" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Seu CEP">
                                </div>
                            </div>
            
                            @if (getFieldPlans(plansInfo.map)) {
                                <div class="col-12 col-md-9">
                                    <div class="mb-4">
                                        <label for="map" class="mb-2 custom-subtitle-dark letter-spacing-1">MAPA<i class="fa-regular fa-circle-question ms-1 cursor_pointer" [ngbTooltip]="tooltips.map"></i></label>
                                        <input type="text" name="map" formControlName="map" id="map" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Tag <iframe> do google maps">
                                    </div>
                                </div>
                            }
                            <hr class="custom-hr-dark mb-4 mb-md-5">
            
                            @if (getFieldPlans(plansInfo.detailsPage)) {
                                <h4 class="text-primary fw-semibold opacity-75 mb-3">Redes sociais</h4>
            
                                <div class="col-12 col-md-4">
                                    <div class="mb-3">
                                        <label for="facebook" class="mb-2 custom-subtitle-dark letter-spacing-1">FACEBOOK</label>
                                        <input type="text" name="facebook" formControlName="facebook" id="facebook" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Ex: https://www.facebook.com/pagina">
                                    </div>
                                </div>
            
                                <div class="col-12 col-md-4">
                                    <div class="mb-3">
                                        <label for="instagram" class="mb-2 custom-subtitle-dark letter-spacing-1">INSTAGRAM</label>
                                        <input type="text" name="instagram" formControlName="instagram" id="instagram" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Ex: https://instagran.com/usuario">
                                    </div>
                                </div>
            
                                <div class="col-12 col-md-4">
                                    <div class="mb-3">
                                        <label for="linkedIn" class="mb-2 custom-subtitle-dark letter-spacing-1">LINKEDIN</label>
                                        <input type="text" name="linkedIn" formControlName="linkedIn" id="linkedIn" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Ex: https://linkedIn.com/usuario">
                                    </div>
                                </div>
            
                                <hr class="custom-hr-dark mb-4 mb-md-5">
                            }
            
                            <h4 class="text-primary fw-semibold opacity-75 mb-3">Contato</h4>
            
                            <div class="col-12 col-md-4" [ngClass]="{'col-md-6': !getFieldPlans(plansInfo.url)}">
                                <div class="mb-3">
                                    <label for="phone" class="mb-2 custom-subtitle-dark letter-spacing-1">TELEFONE<i class="fa-regular fa-circle-question ms-1 cursor_pointer" [ngbTooltip]="tooltips.phone"></i></label>
                                    <input type="text" name="phone" formControlName="phone" id="phone" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Ex: 14991000000" autocomplete="tel">
                                </div>
                            </div>
            
                            <div class="col-12 col-md-4" [ngClass]="{'col-md-6': !getFieldPlans(plansInfo.url)}">
                                <div class="mb-3">
                                    <label for="email" class="mb-2 custom-subtitle-dark letter-spacing-1">E-MAIL</label>
                                    <input type="email" name="email" formControlName="email" id="email" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Ex: guiaagudos@email.com" autocomplete="email">
                                </div>
                            </div>
            
                            @if(getFieldPlans(plansInfo.url)) {
                                <div class="col-12 col-md-4">
                                    <div class="mb-3">
                                        <label for="url" class="mb-2 custom-subtitle-dark letter-spacing-1">URL</label>
                                        <input type="text" name="url" formControlName="url" id="url" class="form-control custom_focus custom_placeholder bg-transparent text-secondary" placeholder="Ex: {{ constants.webSiteDomain }}">
                                    </div>
                                </div>
                            }

                            @if(getFieldPlans(plansInfo.workSchedule)) {
                                <div class="col-md-12 col-lg-5 my-3">
                                    @if (!this.formListing.value.openingHours) {
                                        <div class="d-flex flex-column align-items-center gap-2">
                                            <i class="fa-regular fa-clock fs-1 mb-3"></i>
                                            <h5 class="custom-subtitle-dark text-center">Nenhum horário de funcionamento adicionado</h5>
                                            <button type="button" class="btn btn-sm btn-primary" (click)="openOpiningHours()">Adicionar horário</button>
                                        </div>
                                    } @else {
                                        <div class="d-flex flex-column align-items-center gap-2">
                                            <i class="fa-regular fa-clock fs-1 mb-3"></i>
                                            <h5 class="custom-subtitle-dark text-center">Horário de funcionamento adicionado!</h5>
                                            <div class="d-flex gap-2">
                                                <button type="button" class="btn btn-sm btn-primary" (click)="openOpiningHours()">Atualizar horário</button>
                                                <button type="button" class="btn btn-sm btn-danger" (click)="removeSchedule()">Remover</button>
                                            </div>
                                        </div>
                                    }
                                </div>

                                <hr class="custom-hr-dark mb-4 mb-md-5">
                            }
                            
                            <div class="d-flex justify-content-end my-3">
                                <button type="submit" class="btn btn-outline-primary fw-semibold letter-spacing-1 cursor_wait" (click)="submitFormInfos()">
                                    SALVAR ALTERAÇÕES
                                </button>
                            </div>
                        </div>
                    </form>
                </ng-template>
            </li>
            <li [ngbNavItem]="2">
                <button ngbNavLink class="fw-semibold opacity-75">Imagens</button>
                <ng-template ngbNavContent>
                    <div class="container">
                        <div class="row my-4">
                            <div class="alert alert-info" role="alert">
                                <strong>Nota:</strong> Às vezes, pode ser necessário <span class="alert-link cursor_pointer" (click)="reloadPage()">recarregar a página</span> ou limpar o cache do navegador para visualizar as imagens atualizadas.
                            </div>

                            <div class="col-12 col-md-6 my-3">
                                <div class="border rounded-1 p-3 py-2 mb-3">
                                    <div class="w-100 d-flex justify-content-between align-items-center mb-2">
                                        <p class="m-0 custom-subtitle-dark">Imagem de logo</p>
                                        <div class="d-flex gap-1">
                                            @if (!previewLogoImg) {
                                                <label class="btn btn-primary btn-sm" for="previewLogoImg">
                                                    @if (listing.logoImage) {
                                                        <span>Alterar logo</span>
                                                    } @else if(previewLogoImg) {
                                                        <span>Alterar logo</span>
                                                    } @else {
                                                        <span>Adicionar</span>
                                                    }
                                                </label>
                                            }

                                            @if(!previewLogoImg) {
                                                <button class="btn btn-sm btn-danger"> 
                                                    <i class="fa-solid fa-trash-can text-white fs-6"></i>
                                                </button>
                                            }

                                            @if (previewLogoImg) {
                                                <button class="btn btn-sm btn-primary" (click)="updateLogo()">Salvar</button>
                                            }

                                            @if(previewLogoImg) {
                                                <button class="btn btn-sm btn-danger ">Cancelar</button>
                                            }

                                        </div>
                                    </div>
                                    <hr class="custom-hr-dark m-0">
                                    <div class="py-2 d-flex justify-content-center">
                                        <input type="file" id="previewLogoImg" name="previewLogoImg" (change)="previewLogo($event)" style="display: none;" accept="image/*">
                                        @if(previewLogoImg) {
                                            <img alt="Imagem de logo" class="img-logo rounded-1" [src]="previewLogoImg">
                                        } @else if(listing.logoImage) {
                                            <img alt="Imagem de logo" class="img-logo rounded-1" [src]="constants.listing_logo + listing.logoImage">
                                        }

                                        @if (!previewLogoImg && !listing.logoImage) {
                                            <p class="custom-subtitle-dark px-3 text-center">Imagem de logo não encontrado. Clique em 'Adicionar' para incluir.</p>
                                        }

                                    </div>
                                    @if(previewLogoImg || listing.logoImage) {
                                        <hr class="custom-hr-dark m-0">
                                    }
                                    <p class="custom-subtitle-dark m-0 fs-8 opacity-75 text-center pt-1">Recomenda-se fotos com 250 x 250 px (JPG, JPEG e PNG). Tamanho máximo de 5 MB.</p>
                                </div>
                            </div>

                            @if(getFieldPlans(plansInfo.coverImage)) {
                                <div class="col-12 col-md-6 my-3">
                                    <div class="border rounded-1 p-3 py-2 mb-3">
                                        <div class="w-100 d-flex justify-content-between align-items-center mb-2">
                                            <p class="m-0 custom-subtitle-dark">Imagem de capa</p>
                                            <label class="btn btn-primary btn-sm" for="previewCoverImg">
                                                @if (listing.coverImage) {
                                                    <span>Alterar capa</span>
                                                } @else if(previewCoverImg) {
                                                    <span>Alterar capa</span>
                                                } @else {
                                                    <span>Adicionar</span>
                                                }
                                            </label>
                                        </div>
                                        <hr class="custom-hr-dark m-0">
                                        <div class="py-2 d-flex justify-content-center">
                                            <input type="file" id="previewCoverImg" name="previewCoverImg" (change)="previewCapa($event)" style="display: none;" accept="image/*">

                                            @if(previewCoverImg) {
                                                <img alt="Imagem de capa" class="img-cover rounded-1" [src]="previewCoverImg">
                                            } @else if(listing.coverImage) {
                                                <img alt="Imagem de capa" class="img-cover rounded-1" [src]="constants.listing_cover + listing.coverImage">
                                            }

                                            @if (!previewCoverImg && !listing.coverImage) {
                                                <p class="custom-subtitle-dark px-3 text-center">Imagem de capa não encontrado. Clique em 'Adicionar' para incluir.</p>
                                            }

                                        </div>
                                        @if(previewCoverImg || listing.coverImage) {
                                            <hr class="custom-hr-dark m-0">
                                        }
                                        <p class="custom-subtitle-dark m-0 fs-8 opacity-75 text-center pt-1">Recomenda-se fotos com 1526 x 430 px (JPG, JPEG e PNG). Tamanho máximo de 5 MB.</p>
                                    </div>
                                </div>
                            }

                            @if(getFieldPlans(plansInfo.imageGallery)) {
                                <div class="col-12 col-md-6 my-3">
                                    <div class="d-flex flex-column align-items-center border rounded-1 p-3 mb-3">
                                        <div class="w-100 d-flex justify-content-between align-items-center mb-2">
                                            <p class="m-0 custom-subtitle-dark">Galeria de Fotos</p>
                                            <label class="btn btn-primary btn-sm" for="previewGalleryImg"><span>Adicionar</span></label>
                                        </div>
                                        <div>
                                            <input type="file" id="previewGalleryImg" name="previewGalleryImg" (change)="previewGallery($event)" style="display: none;" accept="image/*" multiple>
                                            <div class="d-flex gap-3 flex-wrap justify-content-center py-3">
                                                <div>
                                                    <img *ngFor="let image of previewGalleryImg" [src]="image" alt="Gallery Image" class="rounded-1 img-gallery m-1">
                                                </div>

                                                @if (!previewGalleryImg.length) {
                                                    <p class="custom-subtitle-dark px-3 text-center">Não foram encontradas imagens. Clique em 'Adicionar' para incluir imagens.</p>
                                                }
                                            </div>
                                            @if(previewGalleryImg.length) {
                                                <hr class="custom-hr-dark m-0">
                                            }
                                            <p class="custom-subtitle-dark m-0 fs-8 opacity-75 text-center pt-1">Recomenda-se fotos com 250 x 250 px (JPG, JPEG e PNG). Tamanho máximo de 5 MB.</p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </ng-template>
            </li>
        </ul>

        <div [ngbNavOutlet]="nav" class="mt-2"></div>
    </div>
</section>

<ng-template #openingHours let-modal>
    <div class="d-flex justify-content-end rounded-top">
        <i class="bi bi-x-lg fs-5 p-2 text-black-50 cursor_pointer" aria-label="Close" (click)="modal.dismiss('Cross click')"></i>
    </div>

    <div class="py-3 pt-0">
        @for (day of daysOfWeek; track $index) {
            <div class="d-flex flex-column align-items-center p-1">
                <p class="custom-subtitle-dark fw-semibold mb-1 letter-spacing-1">{{ day | uppercase }}</p>
                <div class="w-100 d-flex align-items-center justify-content-evenly border-bottom py-2">
                    <div class="d-flex">
                        <input type="time" class="form-control form-control-sm custom_focus custom_placeholder" [(ngModel)]="schedules[day].open">
                    </div>
                        <label class="custom-subtitle-dark opacity-75 mx-2">Até</label>
                    <div class="d-flex">
                        <input type="time" class="form-control form-control-sm custom_focus custom_placeholder" [(ngModel)]="schedules[day].close">
                    </div>
                    <div>
                        <button (click)="cleanScheduleByDay(day)" type="button" class="btn btn-sm btn-light ms-2"><i class="fa-solid fa-eraser"></i></button>
                    </div>
                </div>
            </div>
        }
        
    </div>
    <div class="d-flex justify-content-center gap-2 p-2">
        <button type="button" class="btn btn-outline-primary" (click)="saveSchedule()">Salvar alterações</button>
        <button type="button" class="btn btn-outline-danger" aria-label="Close" (click)="modal.dismiss('Cross click')">Cancelar</button>
    </div>
</ng-template>